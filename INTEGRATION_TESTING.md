# Frontend-Backend Integration Testing Guide

## Phase 1: Character & Voice API Integration

### ✅ Completed Changes

#### New Files Created:
1. **`frontend/api/config.js`** - API configuration and request utilities
2. **`frontend/api/characters.js`** - Character CRUD operations
3. **`frontend/api/voices.js`** - Voice management operations

#### Modified Files:
1. **`frontend/characters.js`** - Updated to use Supabase API instead of localStorage
2. **`frontend/characters.css`** - Added loading spinner styles

---

## Testing Setup

### 1. Start the Backend Server

```bash
cd /home/user/Code
python backend/server.py
```

The server should start on `http://localhost:8000`

**Verify backend is running:**
- Open browser: `http://localhost:8000`
- Should see: `{"name": "Low-Latency Voice Chat Server", "status": "running", ...}`

### 2. Open Frontend

```bash
# If using a development server:
cd /home/user/Code/frontend
python -m http.server 3000

# Then open: http://localhost:3000
```

Or simply open `frontend/index.html` directly in your browser.

---

## Test Checklist

### ✅ Character Operations

#### Test 1: Load Characters from Database
- [ ] Navigate to Characters page (#characters)
- [ ] Should see loading spinner briefly
- [ ] Should display characters from Supabase (or empty state if none exist)
- [ ] Check browser console for: "Loaded X characters and Y voices from backend"

**Expected Behavior:**
- No localStorage usage
- API calls to `/api/characters` and `/api/voices`
- Displays all characters from database

#### Test 2: Create New Character
- [ ] Click "Add Character" button
- [ ] Character card should appear
- [ ] Enter character name: "Test Character 1"
- [ ] Enter system prompt: "You are a helpful assistant"
- [ ] Click "Save Character"
- [ ] Should see notification: "Character Created"
- [ ] Character appears in left sidebar
- [ ] Check Supabase database for new entry

**Expected Behavior:**
- Button shows "Saving..." during operation
- API POST to `/api/characters`
- Character ID auto-generated by backend
- Character persisted to Supabase

#### Test 3: Update Existing Character
- [ ] Click on existing character in list
- [ ] Character card opens with data
- [ ] Modify name: "Test Character 1 Updated"
- [ ] Modify system prompt
- [ ] Click "Save Character"
- [ ] Should see notification: "Character Saved"
- [ ] Changes reflected in sidebar
- [ ] Check Supabase for updated data

**Expected Behavior:**
- API PUT to `/api/characters/{id}`
- Only changed fields sent to backend
- Database updated successfully

#### Test 4: Upload Character Image
- [ ] Open character card
- [ ] Click image upload area (or avatar edit button)
- [ ] Select an image file
- [ ] Image should display immediately
- [ ] Click "Save Character"
- [ ] Image saved to character
- [ ] Reload page - image persists

**Expected Behavior:**
- Image converted to base64 data URL
- Stored in `image_url` field
- Displays in both avatar and upload area

#### Test 5: Delete Character
- [ ] Click on character in list
- [ ] Click "Delete" button
- [ ] Confirm deletion in dialog
- [ ] Should see notification: "Character Deleted"
- [ ] Character removed from list
- [ ] Check Supabase - entry deleted

**Expected Behavior:**
- Confirmation dialog appears
- API DELETE to `/api/characters/{id}`
- Character removed from database
- Card automatically closes

### ✅ Voice Operations

#### Test 6: Load Voices in Dropdown
- [ ] Open character card
- [ ] Click on Profile tab
- [ ] Voice dropdown should be populated with voices from backend
- [ ] If no voices exist, only "Select voice" option shows

**Expected Behavior:**
- API GET to `/api/voices`
- All voices from database appear in dropdown
- No hardcoded dummy voices

#### Test 7: Create Voice (Description Method)
- [ ] Open/create a character
- [ ] Enter character name (required)
- [ ] Switch to "Voice" tab
- [ ] Select "Profile" radio button
- [ ] Enter speaker description: "Warm, friendly, professional female voice"
- [ ] Enter scene prompt: "Audio recorded in quiet studio"
- [ ] Click "Create Voice"
- [ ] Should see notification: "Voice Created"
- [ ] Voice auto-selected in Profile tab dropdown
- [ ] Check Supabase voices table for new entry

**Expected Behavior:**
- Voice name auto-generated from character name + timestamp
- API POST to `/api/voices`
- Voice appears in dropdown immediately
- Method set to "description"

#### Test 8: Create Voice (Clone Method)
- [ ] Open/create a character
- [ ] Switch to "Voice" tab
- [ ] Select "Clone" radio button
- [ ] Speaker description field should be disabled
- [ ] Enter audio path: "/path/to/audio.wav"
- [ ] Enter text path: "/path/to/transcript.txt"
- [ ] Click "Create Voice"
- [ ] Should see notification: "Voice Created"

**Expected Behavior:**
- Method set to "clone"
- Audio and text paths saved to database
- Speaker description ignored (disabled)

### ✅ Error Handling

#### Test 9: Network Error (Backend Offline)
- [ ] Stop the backend server
- [ ] Navigate to Characters page
- [ ] Should see error notification: "Unable to connect to server"
- [ ] Empty character list displayed
- [ ] No crashes or unhandled errors

**Expected Behavior:**
- Graceful error handling
- User-friendly error messages
- App remains functional

#### Test 10: Validation Errors
- [ ] Try to save character without name
- [ ] Should see: "Character name is required"
- [ ] Try to create voice without character name
- [ ] Should see: "Please enter a character name first"
- [ ] Try description voice without speaker description
- [ ] Should see validation error

**Expected Behavior:**
- Client-side validation prevents bad requests
- Clear error messages guide user

#### Test 11: Server Errors
- [ ] Modify backend to return 500 error (temporarily)
- [ ] Try to create/update character
- [ ] Should see: "Server error. Please try again later."
- [ ] Error logged to browser console

**Expected Behavior:**
- 500 errors handled gracefully
- User notified with friendly message
- Technical details in console for debugging

### ✅ Search & Filter

#### Test 12: Character Search
- [ ] Create multiple characters with different names
- [ ] Use search box at top of character list
- [ ] Type partial character name
- [ ] Should filter list in real-time
- [ ] Clear search - all characters reappear

**Expected Behavior:**
- Search is client-side (fast)
- No API calls during search
- Case-insensitive matching

---

## Database Verification

### Check Supabase Directly

1. **Characters Table:**
```sql
SELECT * FROM characters ORDER BY created_at DESC;
```
Should show all created characters with:
- Auto-generated IDs (e.g., "test-character-1-001")
- Names, system prompts, voice references
- Image URLs (base64 data URLs)
- Timestamps

2. **Voices Table:**
```sql
SELECT * FROM voices ORDER BY created_at DESC;
```
Should show all created voices with:
- Voice names (auto-generated)
- Method ("description" or "clone")
- Speaker descriptions and scene prompts
- Audio/text paths (for clone method)

---

## Browser Console Checks

### Expected Console Logs (Success Path):

```javascript
// On page load:
"Loaded 5 characters and 3 voices from backend"
"Characters page initialized"

// On character create:
"Character created: {id: 'test-character-001', name: '...'}"

// On character update:
"Character updated: {id: 'test-character-001', name: '...'}"

// On character delete:
"Character deleted: test-character-001"

// On voice create:
"Voice created: {voice: 'test-character-voice-1234567890', ...}"
```

### Network Tab Verification:

Check Network tab for API calls:
- **GET** `/api/characters` - Status 200
- **GET** `/api/voices` - Status 200
- **POST** `/api/characters` - Status 200 (create)
- **PUT** `/api/characters/{id}` - Status 200 (update)
- **DELETE** `/api/characters/{id}` - Status 200
- **POST** `/api/voices` - Status 200

---

## Common Issues & Fixes

### Issue: "Unable to connect to server"
**Fix:** Ensure backend server is running on port 8000

### Issue: "CORS error" in browser console
**Fix:** Check `CORSMiddleware` configuration in `backend/server.py` (should allow `*` for development)

### Issue: Characters/voices not loading
**Fix:**
1. Check backend logs for errors
2. Verify Supabase connection (check env vars)
3. Test API endpoint directly: `curl http://localhost:8000/api/characters`

### Issue: "404 Not Found" for API calls
**Fix:** Ensure API base URL is correct in `frontend/api/config.js`

### Issue: Character ID generation fails
**Fix:** Backend handles ID generation - check `character_manager.py` logs

---

## Success Criteria

✅ **Integration is successful if:**
1. All characters load from Supabase (not localStorage)
2. Create, update, delete operations work via API
3. Voices load and can be created/assigned
4. Error handling works for network/server issues
5. Data persists after page refresh (from database)
6. No localStorage usage for characters/voices
7. All API calls complete successfully (check Network tab)
8. Console shows no errors (only expected logs)

---

## Next Steps

After Phase 1 testing is complete:
- [ ] Phase 2: Conversation & Message API integration
- [ ] Phase 3: WebSocket for real-time chat
- [ ] Phase 4: Audio input/output integration
- [ ] Phase 5: Full end-to-end voice chat testing
