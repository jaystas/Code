<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiptap Editor</title>
    
    <style>

        .editor-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #1a1a1a;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        /* Toolbar Styles */
        .toolbar {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
            background-color: #191b1f;
            border-bottom: 1px solid #2a2a2a;
            flex-wrap: wrap;
        }

        .toolbar-button {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px 10px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 14px;
            min-width: 36px;
            height: 36px;
        }

        .toolbar-button:hover {
            background-color: #2a2a2a;
            color: #e0e0e0;
        }

        .toolbar-button.is-active {
            background-color: #3b82f6;
            color: white;
        }

        .toolbar-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .toolbar-divider {
            width: 1px;
            height: 24px;
            background-color: #2a2a2a;
            margin: 0 4px;
        }

        .toolbar-dropdown {
            position: relative;
        }

        .dropdown-button {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            font-size: 14px;
            height: 36px;
        }

        .dropdown-button:hover {
            background-color: #2a2a2a;
            color: #e0e0e0;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background-color: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            min-width: 150px;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: #e0e0e0;
            font-size: 14px;
        }

        .dropdown-item:hover {
            background-color: #2a2a2a;
        }

        .dropdown-item.is-active {
            background-color: #3b82f6;
        }

        /* Editor Content Styles */
        .editor-content {
            min-height: 100px;
            height: 300px;
            padding: 24px;
            background-color: #1c1e22;
            color: #e0e0e0;
        }

        .ProseMirror {
            outline: none;
            min-height: 400px;
        }

        .ProseMirror p {
            margin-bottom: 1em;
        }

        .ProseMirror h1 {
            font-size: 2em;
            font-weight: bold;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }

        .ProseMirror h2 {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }

        .ProseMirror h3 {
            font-size: 1.25em;
            font-weight: bold;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }

        .ProseMirror ul,
        .ProseMirror ol {
            padding-left: 1.5em;
            margin-bottom: 1em;
        }

        .ProseMirror li {
            margin-bottom: 0.5em;
        }

        .ProseMirror blockquote {
            border-left: 3px solid #3b82f6;
            padding-left: 1em;
            margin-left: 0;
            margin-bottom: 1em;
            color: #9ca3af;
        }

        .ProseMirror code {
            background-color: #2a2a2a;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .ProseMirror pre {
            background-color: #2a2a2a;
            padding: 1em;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1em;
        }

        .ProseMirror pre code {
            background: none;
            padding: 0;
        }

        .ProseMirror a {
            color: #3b82f6;
            text-decoration: underline;
        }

        .ProseMirror img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
        }

        .ProseMirror mark {
            background-color: #fef08a;
            padding: 2px 0;
            border-radius: 2px;
        }

        .ProseMirror strong {
            font-weight: bold;
        }

        .ProseMirror em {
            font-style: italic;
        }

        .ProseMirror s {
            text-decoration: line-through;
        }

        .ProseMirror u {
            text-decoration: underline;
        }

        /* Bottom Actions */
        .editor-footer {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background-color: #1c1e22;
            border-top: 1px solid #2a2a2a;
        }

        .mic-button {
            background-color: #2a2a2a;
            border: none;
            color: #e0e0e0;
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            width: 48px;
            height: 48px;
        }

        .mic-button:hover {
            background-color: #3a3a3a;
        }

        .send-button {
            background-color: #e0e0e0;
            border: none;
            color: #0a0a0a;
            cursor: pointer;
            padding: 12px 32px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 16px;
            transition: all 0.2s;
        }

        .send-button:hover {
            background-color: #f0f0f0;
        }

        /* Link Popup */
        .link-popup {
            display: none;
            position: absolute;
            background-color: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            gap: 8px;
        }

        .link-popup.show {
            display: flex;
        }

        .link-input {
            background-color: #0f0f0f;
            border: 1px solid #2a2a2a;
            color: #e0e0e0;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 14px;
            min-width: 250px;
        }

        .link-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        /* Color Picker */
        .color-picker {
            display: none;
            position: absolute;
            background-color: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            padding: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
        }

        .color-picker.show {
            display: grid;
        }

        .color-option {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="toolbar" id="toolbar">
            <!-- Toolbar buttons will be dynamically added -->
        </div>
        
        <div class="editor-content">
            <div id="editor"></div>
        </div>

        <div class="editor-footer">
            <button class="mic-button" onclick="handleMic()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
            <button class="send-button" onclick="handleSend()">Send</button>
        </div>
    </div>

    <script type="module">
        // Import Tiptap modules
        import { Editor } from 'https://esm.sh/@tiptap/core';
        import StarterKit from 'https://esm.sh/@tiptap/starter-kit';
        import Underline from 'https://esm.sh/@tiptap/extension-underline';
        import Link from 'https://esm.sh/@tiptap/extension-link';
        import TextAlign from 'https://esm.sh/@tiptap/extension-text-align';
        import Highlight from 'https://esm.sh/@tiptap/extension-highlight';
        import Image from 'https://esm.sh/@tiptap/extension-image';

        // Initialize Tiptap Editor
        const editor = new Editor({
            element: document.querySelector('#editor'),
            extensions: [
                StarterKit.configure({
                    heading: {
                        levels: [1, 2, 3]
                    }
                }),
                Underline,
                Link.configure({
                    openOnClick: false,
                    HTMLAttributes: {
                        class: 'editor-link',
                    },
                }),
                TextAlign.configure({
                    types: ['heading', 'paragraph'],
                }),
                Highlight.configure({
                    multicolor: true
                }),
                Image
            ],
            content: '<p>Start typing here...</p>',
            editorProps: {
                attributes: {
                    class: 'prose prose-invert max-w-none'
                }
            }
        });

        // Create toolbar
        function createToolbar() {
            const toolbar = document.getElementById('toolbar');
            
            const buttons = [
                // Undo/Redo
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/></svg>`,
                    action: () => editor.chain().focus().undo().run(),
                    isActive: () => false,
                    canExecute: () => editor.can().undo()
                },
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/></svg>`,
                    action: () => editor.chain().focus().redo().run(),
                    isActive: () => false,
                    canExecute: () => editor.can().redo()
                },
                'divider',
                // Heading Dropdown
                {
                    type: 'dropdown',
                    label: 'H1',
                    options: [
                        { label: 'Paragraph', action: () => editor.chain().focus().setParagraph().run() },
                        { label: 'Heading 1', action: () => editor.chain().focus().toggleHeading({ level: 1 }).run() },
                        { label: 'Heading 2', action: () => editor.chain().focus().toggleHeading({ level: 2 }).run() },
                        { label: 'Heading 3', action: () => editor.chain().focus().toggleHeading({ level: 3 }).run() }
                    ]
                },
                'divider',
                // Lists Dropdown
                {
                    type: 'dropdown',
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>`,
                    options: [
                        { label: 'Bullet List', action: () => editor.chain().focus().toggleBulletList().run() },
                        { label: 'Ordered List', action: () => editor.chain().focus().toggleOrderedList().run() }
                    ]
                },
                'divider',
                // Blockquote
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/></svg>`,
                    action: () => editor.chain().focus().toggleBlockquote().run(),
                    isActive: () => editor.isActive('blockquote')
                },
                'divider',
                // Bold, Italic, Strikethrough
                {
                    icon: '<strong>B</strong>',
                    action: () => editor.chain().focus().toggleBold().run(),
                    isActive: () => editor.isActive('bold')
                },
                {
                    icon: '<em>I</em>',
                    action: () => editor.chain().focus().toggleItalic().run(),
                    isActive: () => editor.isActive('italic')
                },
                {
                    icon: '<s>S</s>',
                    action: () => editor.chain().focus().toggleStrike().run(),
                    isActive: () => editor.isActive('strike')
                },
                'divider',
                // Code
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`,
                    action: () => editor.chain().focus().toggleCodeBlock().run(),
                    isActive: () => editor.isActive('codeBlock')
                },
                // Underline
                {
                    icon: '<u>U</u>',
                    action: () => editor.chain().focus().toggleUnderline().run(),
                    isActive: () => editor.isActive('underline')
                },
                'divider',
                // Highlight
                {
                    type: 'color-picker',
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11L12 14L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>`,
                    colors: ['#fef08a', '#fca5a5', '#a7f3d0', '#bfdbfe', '#ddd6fe']
                },
                // Link
                {
                    type: 'link',
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>`,
                    isActive: () => editor.isActive('link')
                },
                'divider',
                // Text Align
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="17" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="17" y1="18" x2="3" y2="18"/></svg>`,
                    action: () => editor.chain().focus().setTextAlign('left').run(),
                    isActive: () => editor.isActive({ textAlign: 'left' })
                },
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="10" x2="6" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="18" y1="18" x2="6" y2="18"/></svg>`,
                    action: () => editor.chain().focus().setTextAlign('center').run(),
                    isActive: () => editor.isActive({ textAlign: 'center' })
                },
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="21" y1="10" x2="7" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="21" y1="18" x2="7" y2="18"/></svg>`,
                    action: () => editor.chain().focus().setTextAlign('right').run(),
                    isActive: () => editor.isActive({ textAlign: 'right' })
                },
                'divider',
                // Add Image/Media
                {
                    icon: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>`,
                    label: 'Add',
                    action: () => addImage()
                }
            ];

            buttons.forEach(button => {
                if (button === 'divider') {
                    const divider = document.createElement('div');
                    divider.className = 'toolbar-divider';
                    toolbar.appendChild(divider);
                } else if (button.type === 'dropdown') {
                    const dropdown = createDropdown(button);
                    toolbar.appendChild(dropdown);
                } else if (button.type === 'color-picker') {
                    const colorPicker = createColorPicker(button);
                    toolbar.appendChild(colorPicker);
                } else if (button.type === 'link') {
                    const linkButton = createLinkButton(button);
                    toolbar.appendChild(linkButton);
                } else {
                    const btn = createButton(button);
                    toolbar.appendChild(btn);
                }
            });
        }

        function createButton(config) {
            const button = document.createElement('button');
            button.className = 'toolbar-button';
            button.innerHTML = config.icon || config.label || '';
            
            button.addEventListener('click', () => {
                config.action();
                updateToolbar();
            });

            if (config.canExecute) {
                button.disabled = !config.canExecute();
            }

            if (config.isActive && config.isActive()) {
                button.classList.add('is-active');
            }

            return button;
        }

        function createDropdown(config) {
            const container = document.createElement('div');
            container.className = 'toolbar-dropdown';

            const button = document.createElement('button');
            button.className = 'dropdown-button';
            button.innerHTML = config.icon ? config.icon + ' <span>▼</span>' : config.label + ' <span>▼</span>';

            const content = document.createElement('div');
            content.className = 'dropdown-content';

            config.options.forEach(option => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                item.textContent = option.label;
                item.addEventListener('click', () => {
                    option.action();
                    content.classList.remove('show');
                    updateToolbar();
                });
                content.appendChild(item);
            });

            button.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.dropdown-content').forEach(d => {
                    if (d !== content) d.classList.remove('show');
                });
                content.classList.toggle('show');
            });

            container.appendChild(button);
            container.appendChild(content);
            return container;
        }

        function createColorPicker(config) {
            const container = document.createElement('div');
            container.className = 'toolbar-dropdown';
            container.style.position = 'relative';

            const button = document.createElement('button');
            button.className = 'toolbar-button';
            button.innerHTML = config.icon;

            const picker = document.createElement('div');
            picker.className = 'color-picker';

            config.colors.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color;
                colorOption.addEventListener('click', () => {
                    editor.chain().focus().toggleHighlight({ color }).run();
                    picker.classList.remove('show');
                    updateToolbar();
                });
                picker.appendChild(colorOption);
            });

            button.addEventListener('click', (e) => {
                e.stopPropagation();
                picker.classList.toggle('show');
            });

            container.appendChild(button);
            container.appendChild(picker);
            return container;
        }

        function createLinkButton(config) {
            const button = document.createElement('button');
            button.className = 'toolbar-button';
            button.innerHTML = config.icon;

            button.addEventListener('click', () => {
                if (editor.isActive('link')) {
                    editor.chain().focus().unsetLink().run();
                } else {
                    const url = prompt('Enter URL:');
                    if (url) {
                        editor.chain().focus().setLink({ href: url }).run();
                    }
                }
                updateToolbar();
            });

            if (config.isActive()) {
                button.classList.add('is-active');
            }

            return button;
        }

        function updateToolbar() {
            // Recreate toolbar to update active states
            document.getElementById('toolbar').innerHTML = '';
            createToolbar();
        }

        function addImage() {
            const url = prompt('Enter image URL:');
            if (url) {
                editor.chain().focus().setImage({ src: url }).run();
            }
        }

        function handleMic() {
            console.log('Microphone clicked');
            // Add your microphone logic here
        }

        function handleSend() {
            const content = editor.getHTML();
            console.log('Sending content:', content);
            // Add your send logic here
            // editor.commands.clearContent(); // Uncomment to clear after sending
        }

        // Make functions globally accessible
        window.handleMic = handleMic;
        window.handleSend = handleSend;

        // Close dropdowns when clicking outside
        document.addEventListener('click', () => {
            document.querySelectorAll('.dropdown-content, .color-picker').forEach(d => {
                d.classList.remove('show');
            });
        });

        // Update toolbar on editor changes
        editor.on('update', () => {
            // Optionally update toolbar state
        });

        // Initialize toolbar
        createToolbar();
    </script>
</body>
</html>
